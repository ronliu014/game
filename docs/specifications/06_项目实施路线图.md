# 项目实施路线图

## 文档版本
- **版本号**: v1.0.0
- **创建日期**: 2026-01-19
- **最后更新**: 2026-01-19
- **文档状态**: 正式版

---

## 1. 路线图概述

### 1.1 总体目标
开发一款高质量、可维护、模块化的电路板修复拼图游戏，可作为独立模块被外部系统调用。

### 1.2 开发周期
建议开发周期：**8-12周**（根据团队规模和经验调整）

### 1.3 里程碑规划

```
Week 1-2    : 阶段0 - 环境搭建与技术选型 ✅ (v0.0.1-stage0, 2026-01-20)
Week 3-4    : 阶段1 - 核心框架开发 ✅ (v0.1.0-stage1, 2026-01-20)
Week 5-6    : 阶段2 - 游戏逻辑实现 ✅ (v0.2.0-stage2, 2026-01-20)
Week 7-8    : 阶段3 - 渲染与交互 ⏳ (当前阶段)
Week 9-10   : 阶段4 - 音效特效与优化
Week 11     : 阶段5 - 集成测试与文档
Week 12     : 阶段6 - 发布与部署
```

---

## 2. 阶段0: 环境搭建与技术选型 ✅

### 2.1 已完成工作
- ✅ 项目规范体系建立
  - 项目规划总纲
  - 目录结构规范
  - 文档编写规范
  - 日志系统规范
  - 开发规范

### 2.2 待完成工作

#### 2.2.1 技术选型决策
**任务**: 确定最终技术栈

**候选方案**:

| 技术栈 | 优势 | 劣势 | 推荐度 |
|--------|------|------|--------|
| **Python + Pygame** | 快速开发、易集成、适合2D | 性能中等 | ⭐⭐⭐⭐⭐ |
| Python + Pyglet | 更现代、OpenGL支持好 | 社区较小 | ⭐⭐⭐⭐ |
| Unity + C# | 功能强大、编辑器完善 | 学习曲线陡、较重 | ⭐⭐⭐ |
| Godot | 开源免费、轻量级 | 生态较小 | ⭐⭐⭐⭐ |

**建议**: 使用 **Python + Pygame**
- 符合项目环境（已有conda Game环境）
- 开发效率高
- 易于与外部系统集成
- 2D游戏性能足够

**决策检查清单**:
- [ ] 技术栈选型完成
- [ ] 技术可行性验证（创建原型）
- [ ] 更新《技术方案文档》

#### 2.2.2 开发环境配置
```bash
# 1. 激活conda环境
conda activate Game

# 2. 安装核心依赖（以Pygame为例）
pip install pygame==2.5.2
pip install numpy==1.24.3
pip install pillow==10.0.0

# 3. 安装开发工具
pip install pytest==7.4.0
pip install pytest-cov==4.1.0
pip install black==23.7.0
pip install pylint==2.17.5
pip install mypy==1.4.1
pip install isort==5.12.0

# 4. 保存依赖
pip freeze > requirements.txt
```

**检查清单**:
- [ ] conda环境配置完成
- [ ] 依赖包安装完成
- [ ] requirements.txt生成
- [ ] IDE配置完成（VSCode/PyCharm）
- [ ] Git仓库初始化

#### 2.2.3 目录结构创建
按照《目录结构规范》创建完整目录：

```bash
# 使用脚本自动创建（推荐）
python tools/scripts/init_project_structure.py

# 或手动创建
mkdir -p src/{core/{grid,circuit,level,game_state},rendering/{animation,effects,ui},audio,input,integration,config,utils}
mkdir -p assets/{sprites/{tiles,ui,effects},audio/{sfx,bgm},fonts}
mkdir -p data/{levels,config}
mkdir -p tests/{unit,integration,fixtures}
mkdir -p tools/{level_editor,scripts}
mkdir -p docs/{image,api,changelog}
mkdir -p logs
```

**检查清单**:
- [ ] 所有必需目录已创建
- [ ] .gitignore配置完成
- [ ] README.md创建完成
- [ ] 初始提交完成

---

## 3. 阶段1: 核心框架开发（Week 3-4）

### 3.1 目标
搭建项目骨架和基础设施，为后续开发打下坚实基础。

### 3.2 任务分解

#### 3.2.1 日志系统实现
**文件**: `src/utils/logger.py`

**功能**:
- [ ] 实现GameLogger类
- [ ] 实现JsonFormatter
- [ ] 实现性能日志log_performance
- [ ] 实现日志装饰器
- [ ] 创建日志配置文件
- [ ] 编写单元测试

**验收标准**:
- 日志可以正常输出到控制台和文件
- 日志轮转工作正常
- 性能日志记录准确
- 测试覆盖率≥80%

#### 3.2.2 配置管理系统
**文件**: `src/config/config_manager.py`, `src/config/constants.py`

**功能**:
- [ ] 实现ConfigManager单例类
- [ ] 实现配置加载和获取
- [ ] 定义所有游戏常量
- [ ] 创建游戏配置文件
- [ ] 编写单元测试

**验收标准**:
- 配置可以从JSON文件加载
- 支持点分隔键路径访问
- 配置缺失时使用默认值
- 测试覆盖率≥80%

#### 3.2.3 基础工具类
**文件**: `src/utils/math_utils.py`, `src/utils/file_utils.py`, `src/utils/timer.py`

**功能**:
- [ ] 数学工具函数（角度转换、向量运算等）
- [ ] 文件工具函数（安全路径、资源查找等）
- [ ] 计时器类（用于性能监控）
- [ ] 编写单元测试

**验收标准**:
- 所有工具函数正常工作
- 测试覆盖率≥90%

#### 3.2.4 数据结构定义
**文件**: `src/core/grid/tile_type.py`, `src/core/grid/tile.py`

**功能**:
- [ ] 定义TileType枚举
- [ ] 实现Tile类
- [ ] 实现旋转逻辑
- [ ] 编写单元测试

**Tile类设计**:
```python
@dataclass
class Tile:
    """瓦片类"""
    x: int
    y: int
    tile_type: TileType
    rotation: int = 0  # 0, 90, 180, 270

    def rotate_clockwise(self) -> None:
        """顺时针旋转90度"""
        self.rotation = (self.rotation + 90) % 360

    def is_rotatable(self) -> bool:
        """是否可旋转（电源和终端不可旋转）"""
        return self.tile_type not in [TileType.POWER_SOURCE, TileType.TERMINAL]

    def get_connections(self) -> List[Direction]:
        """获取当前旋转下的连接方向"""
        pass
```

**验收标准**:
- Tile类功能完整
- 旋转逻辑正确
- 测试覆盖率≥90%

---

## 4. 阶段2: 游戏逻辑实现（Week 5-6）✅

**状态**: 已完成 (v0.2.0-stage2, 2026-01-20)

### 4.1 目标
实现核心游戏逻辑，包括网格管理、电路连通性检测、关卡系统。

**完成情况**:
- ✅ 所有计划任务已完成
- ✅ 测试覆盖率96% (超过85%要求)
- ✅ 272个测试全部通过
- ✅ 性能指标达标
- ✅ 5个示例关卡创建完成

### 4.2 任务分解

#### 4.2.1 网格系统 ✅
**文件**: `src/core/grid/grid_manager.py`

**功能**:
- [x] 实现GridManager类
- [x] 网格初始化
- [x] 瓦片旋转操作
- [x] 网格状态查询
- [x] 编写单元测试

**核心方法**:
```python
class GridManager:
    def __init__(self, grid_size: int)
    def get_tile(self, x: int, y: int) -> Optional[Tile]
    def rotate_tile(self, x: int, y: int) -> bool
    def get_power_source(self) -> Tile
    def get_terminal(self) -> Tile
    def reset_grid(self) -> None
```

**验收标准**:
- ✅ 网格创建和管理正常
- ✅ 瓦片旋转逻辑正确
- ✅ 边界检查完善
- ✅ 测试覆盖率100% (超过85%要求)

#### 4.2.2 连通性检测算法 ✅
**文件**: `src/core/circuit/connectivity_checker.py`

**功能**:
- [x] 实现BFS连通性检测
- [x] 实现路径查找
- [x] 电路验证逻辑
- [x] 编写单元测试

**核心算法**:
```python
class ConnectivityChecker:
    def check_connectivity(self, grid: GridManager) -> bool:
        """检查电源到终端是否连通"""

    def find_path(self, grid: GridManager) -> Optional[List[Tile]]:
        """查找电源到终端的路径"""

    def get_connected_tiles(self, grid: GridManager) -> Set[Tile]:
        """获取所有连通的瓦片（用于动画）"""
```

**性能要求**:
- ✅ 4x4网格: < 5ms
- ✅ 8x8网格: < 20ms

**验收标准**:
- ✅ 连通性检测准确
- ✅ 性能满足要求
- ✅ 边界情况处理正确
- ✅ 测试覆盖率99% (超过90%要求)

#### 4.2.3 关卡系统 ✅
**文件**: `src/core/level/level_manager.py`, `src/core/level/level_loader.py`

**功能**:
- [x] 实现LevelLoader（加载关卡数据）
- [x] 实现LevelManager（关卡管理）
- [x] 关卡验证逻辑
- [x] 创建示例关卡数据
- [x] 编写单元测试

**关卡数据格式**:
```json
{
  "level_id": "001",
  "version": "1.0",
  "name": "初学者",
  "difficulty": 1,
  "grid_size": 4,
  "solution": {
    "tiles": [
      {"x": 0, "y": 0, "type": "power_source", "rotation": 0},
      {"x": 1, "y": 0, "type": "straight", "rotation": 0},
      {"x": 2, "y": 0, "type": "corner", "rotation": 90},
      {"x": 2, "y": 1, "type": "straight", "rotation": 90},
      {"x": 2, "y": 2, "type": "terminal", "rotation": 0}
    ]
  },
  "initial_state": {
    "rotated_tiles": [
      {"x": 1, "y": 0, "rotation": 90},
      {"x": 2, "y": 0, "rotation": 180}
    ]
  }
}
```

**验收标准**:
- ✅ 关卡数据加载正常
- ✅ 关卡验证逻辑正确
- ✅ 创建5个示例关卡 (level_001 到 level_005)
- ✅ LevelLoader测试覆盖率85%, LevelManager测试覆盖率98%

#### 4.2.4 游戏状态机 ✅
**文件**: `src/core/game_state/state_machine.py`

**功能**:
- [x] 定义游戏状态枚举
- [x] 实现状态机
- [x] 状态转换逻辑
- [x] 编写单元测试

**状态定义**:
```python
class GameState(Enum):
    INIT = "init"
    LOADING = "loading"
    PLAYING = "playing"
    VICTORY = "victory"
    PAUSED = "paused"
    EXITING = "exiting"
```

**验收标准**:
- ✅ 状态转换逻辑正确
- ✅ 非法转换被拒绝
- ✅ 状态变更有日志记录
- ✅ 测试覆盖率97% (超过85%要求)

---

## 5. 阶段3: 渲染与交互（Week 7-8）

### 5.1 目标
实现游戏的视觉呈现和用户交互。

### 5.2 任务分解

#### 5.2.1 渲染引擎集成
**文件**: `src/rendering/renderer.py`, `src/rendering/sprite_manager.py`

**功能**:
- [ ] 初始化渲染引擎（Pygame）
- [ ] 实现SpriteManager
- [ ] 资源加载和管理
- [ ] 基本绘制逻辑
- [ ] 编写集成测试

**验收标准**:
- 窗口正常创建
- 精灵正常加载和显示
- 帧率稳定≥60 FPS
- 资源占用合理

#### 5.2.2 UI系统
**文件**: `src/rendering/ui/ui_manager.py`, `src/rendering/ui/button.py`, `src/rendering/ui/hud.py`

**功能**:
- [ ] 实现Button组件
- [ ] 实现HUD（抬头显示）
- [ ] 实现Panel组件
- [ ] UI事件处理
- [ ] 编写测试

**UI组件**:
- 关卡选择界面
- 游戏界面（网格、按钮、状态显示）
- 胜利界面

**验收标准**:
- UI交互流畅
- 按钮响应正常
- 视觉效果符合设计
- 适配不同分辨率

#### 5.2.3 动画系统
**文件**: `src/rendering/animation/animator.py`, `src/rendering/animation/rotation_animation.py`

**功能**:
- [ ] 实现Animator基类
- [ ] 实现旋转动画
- [ ] 实现电流流动动画
- [ ] 动画插值算法
- [ ] 编写测试

**动画要求**:
- 旋转动画: 300ms, 缓动函数
- 电流动画: 循环播放，速度可配置
- 胜利特效: 粒子爆发

**验收标准**:
- 动画流畅自然
- 性能影响小
- 可配置动画参数

#### 5.2.4 输入处理
**文件**: `src/input/input_manager.py`, `src/input/mouse_handler.py`

**功能**:
- [ ] 实现InputManager
- [ ] 鼠标点击检测
- [ ] 网格坐标转换
- [ ] 编写测试

**验收标准**:
- 点击检测准确
- 坐标转换正确
- 支持多种输入设备

---

## 6. 阶段4: 音效特效与优化（Week 9-10）

### 6.1 任务分解

#### 6.1.1 音频系统
**文件**: `src/audio/audio_manager.py`, `src/audio/sound_player.py`, `src/audio/bgm_controller.py`

**功能**:
- [ ] 实现AudioManager
- [ ] 音效播放
- [ ] BGM控制（音量调整）
- [ ] 音频资源管理
- [ ] 编写测试

**音频资源**:
- 旋转音效（click.wav）
- 连接音效（connect.wav）
- 胜利音效（victory.wav）
- 背景音乐（game_theme.mp3）

**验收标准**:
- 音效播放正常
- BGM音量调整符合要求
- 无音频卡顿

#### 6.1.2 视觉特效
**文件**: `src/rendering/effects/particle_system.py`, `src/rendering/effects/glow_effect.py`

**功能**:
- [ ] 实现粒子系统
- [ ] 发光效果（终端）
- [ ] 胜利特效
- [ ] 电流特效
- [ ] 编写测试

**验收标准**:
- 特效视觉效果好
- 性能影响可控
- 可配置特效参数

#### 6.1.3 性能优化
**任务**:
- [ ] 性能分析和瓶颈定位
- [ ] 渲染优化（精灵批处理、裁剪）
- [ ] 内存优化（资源缓存、释放）
- [ ] 算法优化（如需要）
- [ ] 性能测试

**性能目标**:
- 帧率: ≥60 FPS
- 内存: ≤100MB
- 启动时间: ≤2秒
- 关卡加载: ≤500ms

**验收标准**:
- 所有性能指标达标
- 性能日志记录完整

---

## 7. 阶段5: 集成与测试（Week 11）

### 7.1 任务分解

#### 7.1.1 外部接口开发
**文件**: `src/integration/game_api.py`, `src/integration/callback_handler.py`

**功能**:
- [ ] 实现GameAPI类
- [ ] 关卡启动接口
- [ ] 回调机制
- [ ] 集成文档编写
- [ ] 示例代码

**API设计**:
```python
class GameAPI:
    """游戏对外API"""

    def start_game(self, level_ids: List[str],
                   on_complete: Callable = None,
                   on_exit: Callable = None) -> None:
        """
        启动游戏

        Args:
            level_ids: 关卡ID列表
            on_complete: 完成回调
            on_exit: 退出回调
        """

    def stop_game(self) -> None:
        """停止游戏"""

    def get_status(self) -> Dict:
        """获取游戏状态"""
```

**验收标准**:
- API接口完整
- 回调机制正常
- 文档清晰完整
- 提供完整示例

#### 7.1.2 集成测试
**文件**: `tests/integration/test_game_flow.py`

**测试场景**:
- [ ] 完整游戏流程测试
- [ ] 多关卡连续测试
- [ ] 边界条件测试
- [ ] 异常场景测试
- [ ] 性能压力测试

**验收标准**:
- 所有集成测试通过
- 测试覆盖主要场景
- 性能测试达标

#### 7.1.3 文档完善
**任务**:
- [ ] 完善API文档
- [ ] 编写用户手册
- [ ] 更新README
- [ ] 创建CHANGELOG
- [ ] 编写故障排查手册

**验收标准**:
- 所有文档完整准确
- 示例代码可运行
- 文档格式规范

---

## 8. 阶段6: 发布与部署（Week 12）

### 8.1 任务分解

#### 8.1.1 构建与打包
**任务**:
- [ ] 创建构建脚本
- [ ] 打包游戏资源
- [ ] 创建安装包
- [ ] 编写部署文档

**构建脚本**: `tools/scripts/build.py`

**验收标准**:
- 可一键构建
- 打包完整无遗漏
- 安装包可用

#### 8.1.2 最终测试
**任务**:
- [ ] 功能回归测试
- [ ] 兼容性测试
- [ ] 用户验收测试
- [ ] Bug修复

**验收标准**:
- 所有测试通过
- 关键Bug清零
- 用户反馈积极

#### 8.1.3 发布准备
**任务**:
- [ ] 版本号确定
- [ ] CHANGELOG生成
- [ ] 发布说明编写
- [ ] 示例项目准备
- [ ] 技术支持准备

**验收标准**:
- 发布材料完整
- 文档齐全
- 可交付使用

---

## 9. 持续维护阶段

### 9.1 维护计划
- **Bug修复**: 及时响应和修复
- **性能优化**: 持续监控和优化
- **功能迭代**: 根据反馈增加新功能
- **文档更新**: 保持文档与代码同步

### 9.2 潜在扩展
- 更多关卡类型（障碍物、多终端等）
- 关卡编辑器完善
- 成就系统
- 统计系统
- 多语言支持

---

## 10. 风险与应对

### 10.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 性能不达标 | 高 | 中 | 早期性能测试，预留优化时间 |
| 技术选型不当 | 高 | 低 | 阶段0制作原型验证 |
| 集成困难 | 中 | 中 | 清晰的接口设计，充分测试 |

### 10.2 进度风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 需求变更 | 中 | 高 | 模块化设计，预留扩展点 |
| 时间不足 | 高 | 中 | 分阶段交付，优先核心功能 |
| 资源不足 | 中 | 中 | 合理分配，借助工具自动化 |

---

## 11. 关键成功因素

### 11.1 必须做到
1. ✅ **严格遵循规范**: 所有代码遵循开发规范
2. ✅ **完整的测试**: 核心模块测试覆盖率≥80%
3. ✅ **性能达标**: 满足所有性能指标
4. ✅ **文档齐全**: 代码、API、用户文档完整
5. ✅ **代码审查**: 所有代码经过审查

### 11.2 建议做到
1. ⭐ 自动化构建和测试
2. ⭐ 持续集成（CI/CD）
3. ⭐ 代码质量自动检查
4. ⭐ 性能监控和分析
5. ⭐ 技术分享和知识沉淀

---

## 12. 检查清单模板

### 12.1 阶段完成检查清单

每个阶段完成时使用此清单验收：

- [ ] 所有计划任务已完成
- [ ] 代码符合开发规范
- [ ] 单元测试覆盖率达标
- [ ] 集成测试通过
- [ ] 性能指标达标
- [ ] 代码审查通过
- [ ] 文档已更新
- [ ] 日志记录完整
- [ ] Git提交信息规范
- [ ] 无已知严重Bug

### 12.2 发布检查清单

最终发布前使用：

- [ ] 所有功能完整实现
- [ ] 所有测试通过
- [ ] 性能指标全部达标
- [ ] 文档完整准确
- [ ] API文档齐全
- [ ] 示例代码可运行
- [ ] README完整
- [ ] CHANGELOG准确
- [ ] 版本号正确
- [ ] 无已知关键Bug
- [ ] 代码仓库整洁
- [ ] 发布说明准备好

---

## 13. 附录

### 13.1 工具脚本清单

建议创建以下工具脚本：

```
tools/scripts/
├── init_project_structure.py    # 初始化项目目录
├── create_doc.py                 # 创建文档模板
├── build.py                      # 构建脚本
├── deploy.py                     # 部署脚本
├── generate_docs.py              # 生成API文档
├── clean_logs.py                 # 清理日志
└── run_tests.py                  # 运行测试
```

### 13.2 参考资料
- 项目规划总纲: `docs/specifications/00_项目规划总纲.md`
- 目录结构规范: `docs/specifications/02_目录结构规范.md`
- 文档编写规范: `docs/specifications/03_文档编写规范.md`
- 日志系统规范: `docs/specifications/04_日志系统规范.md`
- 开发规范: `docs/specifications/05_开发规范.md`
- 游戏设计文档: `docs/派对游戏 - 修复电路板_设计文档.md`

---

## 14. 文档变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0.0 | 2026-01-19 | Claude | 初始版本，制定完整的项目实施路线图 |

---

**重要提示**:
1. 本路线图是指导性文档，可根据实际情况调整
2. 每个阶段完成后必须验收
3. 遇到问题及时调整计划
4. 保持团队沟通，确保进度透明
5. 质量优先于进度

**下一步行动**:
1. 完成阶段0剩余工作（技术选型、环境配置）
2. 更新《技术方案文档》
3. 开始阶段1开发工作
