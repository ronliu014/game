# 修复电路板游戏 - 标准Markdown文档（含图片占位符）

> 说明：文档中所有 `[图片占位符-xxx.png]` 处需用户自行替换为实际图片文件路径或URL，替换说明已标注在每个占位符下方

## 1. 游戏定位

- 1.作为独立小游戏，可以被其他系统调用出现
- 2.支持无限模式，关卡动态生成，永不重复
- 3.提供四个难度级别（简单、普通、困难、地狱），在被调用时可选择难度
- 4.开始游戏后通过2D界面做出简单的操作，旋转电路方块，从而顺利通过关卡

---

## 2. 游戏界面说明

如下图所示

### 2.1 游戏界面示意图
![游戏界面示意图](../assets/image/image01.png)
> 替换说明：此处需插入游戏整体界面图，包含电源端、终端、电路方块、小提示区、退出按钮等核心元素，建议尺寸800×600px

---

## 3. 界面功能元素说明

| 元素名称 | 功能说明 | 图片资源 |
|----------|----------|----------|
| 电源端 | 默认为亮起状态，不会因为任何情况而熄灭 | ![游戏界面示意图](../assets/image/image02.png) |
| 终端 | 在全部格子角度正确时，终点灯光亮起，并且视为闯关成功 | ![游戏界面示意图](../assets/image/image06.png) |
| 小提示 | 1.在游戏开始时，出现该提示，停留2s后消失<br>2.在玩家选择非黑色格子时，出现该提示，停留2s后消失（停留期间重复点击错误格子，不会重置持续时间） | ![游戏界面示意图](../assets/image/image04.png) |
| 退出游戏 | 关闭该界面，视为退出游戏并无需保留游戏进度 | ![游戏界面示意图](../assets/image/image05.png) |


### 3.1 功能元素标注图
有2种线路，直角线和直线

| 元素名称 | 图片资源 |
|----------|----------|
|直线|![游戏界面示意图](../assets/image/image08.png)|
|直角线|![功能元素标注图](../assets/image/image03.png)|


## 4. 玩法规则

### 4.1 玩法目标
- 玩家通过点击带电路的黑色方块，旋转其电路走向，最终让 “电源端”（发光圆口）与 “终端”（白色圆口）的电路完全连通。

### 4.2 操作规则
- **基础操作**：点击黑色方块→方块内电路顺时针旋转（每次旋转 90°）
- 1.第一次点击非选中的黑色方块，视为选中
- 2.点击选中的黑色方块，视为旋转

### 4.3 操作演示示意图
![操作演示示意图](../assets/image/image01.png)
> 替换说明：此处需插入操作流程演示图，可分步骤展示“选中方块”“旋转电路”“电路连通”的效果，建议用多图组合或GIF动图


---

## 5. 关卡设计

### 5.1 关卡设计理念
修复电路板小游戏采用**动态生成算法**，每次游戏都会生成全新的关卡布局，确保游戏的可重玩性和挑战性。

### 5.2 关卡生成算法（V3版本）

#### 5.2.1 核心算法流程
关卡生成遵循以下步骤：

1. **选择端点位置**
   - 在 N×N 网格中随机选择电源端（起点）和终端（终点）位置
   - 确保两点之间的曼哈顿距离 ≥ 2（至少有1个中间方块）

2. **路径查找（DFS算法）**
   - 使用深度优先搜索（DFS）从电源端查找到终端的路径
   - **不要求最短路径**，允许曲折路径，增加游戏趣味性
   - 随机选择探索方向，确保每次生成的路径都不同

3. **确定方块配置**
   - 对路径上的每个方块，根据**前一个、当前、下一个**方块的相对位置
   - 自动确定应使用的精灵类型（直线/拐角）和旋转角度

4. **难度验证**
   - 检查可移动方块数量是否符合难度要求
   - 检查拐角数量是否符合难度要求
   - 不符合则重新生成

5. **打乱方块**
   - 根据难度设置，将一定比例的方块旋转到错误角度
   - 被打乱的方块自动变为黑色（可点击）

#### 5.2.2 坐标系统定义
游戏使用**屏幕坐标系**：
- **X轴**：向右为正方向（0 → N-1）
- **Y轴**：向下为正方向（0 → N-1）
- 原点(0,0)在左上角

#### 5.2.3 精灵旋转定义

**直线精灵（tile_straight.png）**：
- **0°**：水平直线（左 ↔ 右）
- **90°**：竖直直线（上 ↔ 下）
- **180°**：水平直线（等价于0°）
- **270°**：竖直直线（等价于90°）

**拐角精灵（tile_corner.png）**：
- **0°**：连接上方和右方（从上转右：└）
- **90°**：连接右方和下方（从右转下：┌）
- **180°**：连接下方和左方（从下转左：┐）
- **270°**：连接左方和上方（从左转上：┘）

#### 5.2.4 方块配置逻辑

对于路径上的每个中间方块，根据相对位置确定配置：

**示例1：前一个在正上方，下一个在正右方**
```
前: (x, y-1)  ← 在当前方块的上方
当前: (x, y)
下: (x+1, y)  ← 在当前方块的右方
→ 使用 0° 拐角（连接上和右）
```

**示例2：前一个在正左方，下一个在正右方**
```
前: (x-1, y)  ← 在当前方块的左方
当前: (x, y)
下: (x+1, y)  ← 在当前方块的右方
→ 使用 0° 或 180° 直线（水平连接）
```

**关键规则**：
- 判断方向时，比较坐标值：
  - `prev_x < cur_x` → 前一个在**左方**
  - `prev_x > cur_x` → 前一个在**右方**
  - `prev_y < cur_y` → 前一个在**上方**
  - `prev_y > cur_y` → 前一个在**下方**

#### 5.2.5 难度系统

| 难度 | 网格大小 | 可移动方块 | 拐角数量 | 打乱比例 |
|------|---------|-----------|---------|---------|
| 简单 | 4×4 ~ 5×5 | 3~6个 | 1~3个 | ≥70% |
| 普通 | 5×5 ~ 6×6 | 5~10个 | 2~5个 | ≥80% |
| 困难 | 6×6 ~ 7×7 | 8~15个 | 3~8个 | ≥90% |
| 地狱 | 7×7 ~ 8×8 | 12~20个 | 5~12个 | 100% |

**说明**：
- **可移动方块**：路径上除电源端和终端外的方块数量
- **拐角数量**：路径中使用拐角精灵的方块数量
- **打乱比例**：被旋转到错误角度的方块占可移动方块的比例

### 5.3 关卡实现流程图
- 1.通电的终端
![关卡实现流程图](../assets/image/image09.png)
- 2.未通电的终端
![关卡实现流程图](../assets/image/image12.png)
- 3.通电的电线
![关卡实现流程图](../assets/image/image10.png)
- 4.未通电的电线
![关卡实现流程图](../assets/image/image11.png)
> 替换说明：此处需插入关卡制作流程图，展示从"设定尺寸"→"定义元素"→"设置错误方块"的完整流程

### 5.4 关卡元素定义
| 元素类型 | 数量/属性 | 说明 |
|----------|-----------|------|
| 电源端 | 1.0 | 关卡基础组成元素，提供电力来源，默认常亮 |
| 终端 | 1.0 | 关卡基础组成元素，电路连通后点亮，标志闯关成功 |
| 直线 | 2.0 | 关卡基础组成元素，用于构建直线方向的电路通路 |
| 角度线 | 3.0 | 关卡基础组成元素，用于构建转角方向的电路通路 |

### 5.5 关卡示例数据
| 数据类型 | 数值/ID | 说明 |
|----------|---------|------|
| 关卡大小 | 4,4（4×4方块） | 标准关卡尺寸，横向4个方块、纵向4个方块 |
| 主要关卡ID | 1001 | 核心关卡标识，用于系统调用和进度保存 |
| 辅助功能ID | 1, 2, 3, 4, 5, 6, 7 | 对应界面交互、音效、特效等功能模块标识 |

### 5.6 关卡示例效果图
![关卡示例效果图](../assets/image/image01.png)
> 替换说明：此处需插入1001关卡的实际效果图，展示4×4方块布局、电路分布、可旋转黑色方块的位置

---

## 6. 视觉表现设计

### 6.1 整体风格
- 复古工业风（参考当前界面的黄铜边框 + 水泥纹理 + 红铜电路），突出 “蒸汽朋克” 质感；

### 6.2 方块表现
- 方块需区分 “可旋转”与 “固定电路” 方块；

### 6.3 电路表现
- 从【电源端】开始，沿着电源开始，正确的线路两头需要添加“电流流动” 特效

### 6.4 终端表现
- 通关时添加渐变的动画（如终端从暗到亮的渐变）

### 6.5 特效表现
- 通关时，玩家无法进行任何操作，等待终端表现动画播放完毕后，播放屏幕UI动效（恭喜完成礼花）
- 礼花特效播放完毕后，略微等待1秒即可进行下一关or关闭游戏

### 6.6 BGM控制
- 界面开启时，将降低游戏BGM，将至20%左右（可调试）

### 6.7 视觉效果展示图
![视觉效果展示图](../assets/image/image01.png)
> 替换说明：此处需插入视觉风格展示图，包含蒸汽朋克风格的边框、纹理、电路特效、礼花动效等细节展示

---

## 7. 音效设计

| 应用场景 | 音效类型 | 音效描述 |
|----------|----------|----------|
| 操作反馈 | 特效音效 | 电路旋转到位：叠加轻微 “齿轮咬合” 音效； |
| 电路连通 | 特效音效 | 播放 “电流嗡鸣 + 金属通电” 的组合音效（音量渐强） |
| 关卡通关 | 特效音效 | 播放 “复古机械装置启动” 的长音效（配合终端点亮动画） |
| 胜利反馈 | 特效音效 | 恭喜完成的礼花音效和胜利BGM |

---

## 8. 通关流程设计

### 8.1 通关步骤
1. 玩家通过旋转黑色方块调整电路走向
2. 每次旋转后自动检测电路连通性
3. 电路完全连通后，触发电流流动特效
4. 终端从暗到亮播放渐变点亮动画
5. 播放关卡通关专属音效
6. 显示"恭喜完成"礼花特效并播放胜利音效
7. 等待1秒后，自动生成下一关（保持当前难度）
8. 提供"继续游戏"和"关闭游戏"选项

### 8.2 无限模式说明
- 游戏采用**无限模式**，通关后自动生成新关卡
- 每个关卡都是动态生成的，永不重复
- 关卡编号会持续累加（第1关、第2关、第3关...）
- 玩家可随时退出，无需保存进度
- 重新开始游戏时，关卡编号从1重新开始

### 8.3 通关流程时序图
![通关流程时序图](../assets/image/image07.png)
> 替换说明：此处需插入通关流程时序图，按步骤展示从"电路连通"到"进入下一关"的完整过程和对应效果

---

## 9. 文档使用说明

- 所有 `[图片占位符-xxx.png]` 需替换为实际图片文件路径，支持本地相对路径（如`./images/游戏界面.png`）和网络URL（如`https://xxx.com/游戏界面.png`）
- 图片建议格式：PNG/JPG，推荐分辨率：800×600px及以上，确保界面元素清晰可辨
- 替换图片时，需确保图片内容与对应章节的说明相符（如“操作演示图”需展示点击旋转的操作过程）
- 如需调整文档结构，可根据实际需求增删章节或修改文字内容，保持Markdown格式规范即可
