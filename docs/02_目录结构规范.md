# 目录结构规范

## 文档版本
- **版本号**: v1.0.0
- **创建日期**: 2026-01-19
- **最后更新**: 2026-01-19
- **文档状态**: 正式版

---

## 1. 总体原则

### 1.1 设计理念
- **功能优先**: 按功能模块组织，而非文件类型
- **就近原则**: 相关文件放在同一目录
- **扁平化**: 避免过深的目录嵌套（≤4层）
- **可预测性**: 目录命名清晰，易于查找

### 1.2 命名规范
- **目录名**: 小写字母+下划线，如 `game_logic`、`audio_system`
- **文件名**: 小写字母+下划线，如 `grid_manager.py`、`level_config.json`
- **类名**: 大驼峰命名，如 `GridManager`、`LevelLoader`
- **常量**: 全大写+下划线，如 `MAX_GRID_SIZE`、`DEFAULT_ROTATION`

---

## 2. 标准目录结构

```
circuit-repair-game/                    # 项目根目录
│
├── docs/                               # 📚 文档目录
│   ├── 00_项目规划总纲.md              # 项目总纲（本规范的上级文档）
│   ├── 01_技术方案文档.md              # 技术选型与架构
│   ├── 02_目录结构规范.md              # 本文档
│   ├── 03_文档编写规范.md              # 文档标准
│   ├── 04_日志系统规范.md              # 日志规范
│   ├── 05_开发规范.md                  # 开发标准
│   ├── 派对游戏 - 修复电路板_设计文档.md  # 游戏设计
│   ├── 派对游戏-修复电路板.xlsx        # Excel规格表
│   ├── image/                          # 设计稿与UI原型
│   │   ├── ui_mockup_01.png
│   │   └── ...
│   ├── api/                            # API文档（自动生成）
│   └── changelog/                      # 版本变更记录
│       └── CHANGELOG.md
│
├── src/                                # 🔧 源代码目录
│   ├── __init__.py
│   ├── main.py                         # 程序入口
│   │
│   ├── core/                           # 核心游戏逻辑（无渲染依赖）
│   │   ├── __init__.py
│   │   ├── grid/                       # 网格系统
│   │   │   ├── __init__.py
│   │   │   ├── grid_manager.py         # 网格管理器
│   │   │   ├── tile.py                 # 单个瓦片
│   │   │   └── tile_type.py            # 瓦片类型枚举
│   │   │
│   │   ├── circuit/                    # 电路逻辑
│   │   │   ├── __init__.py
│   │   │   ├── connectivity_checker.py # 连通性检测算法
│   │   │   ├── path_finder.py          # 路径查找
│   │   │   └── circuit_validator.py    # 电路验证
│   │   │
│   │   ├── level/                      # 关卡系统
│   │   │   ├── __init__.py
│   │   │   ├── level_manager.py        # 关卡管理器
│   │   │   ├── level_loader.py         # 关卡加载器
│   │   │   └── level_data.py           # 关卡数据结构
│   │   │
│   │   └── game_state/                 # 游戏状态机
│   │       ├── __init__.py
│   │       ├── state_machine.py        # 状态机
│   │       └── game_states.py          # 各种游戏状态
│   │
│   ├── rendering/                      # 渲染层（依赖具体图形库）
│   │   ├── __init__.py
│   │   ├── renderer.py                 # 主渲染器
│   │   ├── sprite_manager.py           # 精灵管理
│   │   ├── animation/                  # 动画系统
│   │   │   ├── __init__.py
│   │   │   ├── animator.py             # 动画控制器
│   │   │   ├── rotation_animation.py   # 旋转动画
│   │   │   └── current_animation.py    # 电流动画
│   │   │
│   │   ├── effects/                    # 视觉特效
│   │   │   ├── __init__.py
│   │   │   ├── particle_system.py      # 粒子系统
│   │   │   ├── glow_effect.py          # 发光效果
│   │   │   └── victory_effect.py       # 胜利特效
│   │   │
│   │   └── ui/                         # UI系统
│   │       ├── __init__.py
│   │       ├── ui_manager.py           # UI管理器
│   │       ├── button.py               # 按钮组件
│   │       ├── panel.py                # 面板组件
│   │       └── hud.py                  # 抬头显示
│   │
│   ├── audio/                          # 音频系统
│   │   ├── __init__.py
│   │   ├── audio_manager.py            # 音频管理器
│   │   ├── sound_player.py             # 音效播放器
│   │   └── bgm_controller.py           # 背景音乐控制
│   │
│   ├── input/                          # 输入处理
│   │   ├── __init__.py
│   │   ├── input_manager.py            # 输入管理器
│   │   └── mouse_handler.py            # 鼠标处理
│   │
│   ├── integration/                    # 外部集成接口
│   │   ├── __init__.py
│   │   ├── game_api.py                 # 对外API
│   │   └── callback_handler.py         # 回调处理
│   │
│   ├── config/                         # 配置管理
│   │   ├── __init__.py
│   │   ├── config_manager.py           # 配置管理器
│   │   ├── game_config.py              # 游戏配置
│   │   └── constants.py                # 常量定义
│   │
│   └── utils/                          # 工具类
│       ├── __init__.py
│       ├── logger.py                   # 日志工具
│       ├── math_utils.py               # 数学工具
│       ├── file_utils.py               # 文件工具
│       └── timer.py                    # 计时器
│
├── assets/                             # 🎨 资源文件目录
│   ├── sprites/                        # 精灵图
│   │   ├── tiles/                      # 瓦片图
│   │   │   ├── power_source.png
│   │   │   ├── terminal.png
│   │   │   ├── straight_line.png
│   │   │   ├── corner.png
│   │   │   └── ...
│   │   ├── ui/                         # UI元素
│   │   │   ├── button_normal.png
│   │   │   ├── button_hover.png
│   │   │   └── ...
│   │   └── effects/                    # 特效图
│   │       ├── spark.png
│   │       ├── glow.png
│   │       └── ...
│   │
│   ├── audio/                          # 音频文件
│   │   ├── sfx/                        # 音效
│   │   │   ├── click.wav
│   │   │   ├── rotate.wav
│   │   │   ├── connect.wav
│   │   │   ├── victory.wav
│   │   │   └── ...
│   │   └── bgm/                        # 背景音乐
│   │       ├── game_theme.mp3
│   │       └── ...
│   │
│   ├── fonts/                          # 字体文件
│   │   └── game_font.ttf
│   │
│   └── shaders/                        # 着色器（如需要）
│       ├── glow.glsl
│       └── ...
│
├── data/                               # 📊 数据文件目录
│   ├── levels/                         # 关卡数据
│   │   ├── level_001.json
│   │   ├── level_002.json
│   │   └── ...
│   │
│   ├── config/                         # 配置文件
│   │   ├── game_config.json            # 游戏配置
│   │   ├── audio_config.json           # 音频配置
│   │   └── render_config.json          # 渲染配置
│   │
│   └── localization/                   # 本地化（如需要）
│       ├── zh_CN.json
│       └── en_US.json
│
├── tests/                              # 🧪 测试目录
│   ├── __init__.py
│   ├── unit/                           # 单元测试
│   │   ├── test_grid_manager.py
│   │   ├── test_connectivity_checker.py
│   │   └── ...
│   │
│   ├── integration/                    # 集成测试
│   │   ├── test_game_flow.py
│   │   └── ...
│   │
│   └── fixtures/                       # 测试数据
│       ├── test_level_01.json
│       └── ...
│
├── tools/                              # 🛠️ 开发工具
│   ├── level_editor/                   # 关卡编辑器
│   │   └── editor.py
│   │
│   ├── asset_converter/                # 资源转换工具
│   │   └── converter.py
│   │
│   └── scripts/                        # 辅助脚本
│       ├── build.py                    # 构建脚本
│       ├── deploy.py                   # 部署脚本
│       └── generate_docs.py            # 文档生成
│
├── logs/                               # 📝 日志目录（运行时生成）
│   ├── game.log                        # 主日志
│   ├── error.log                       # 错误日志
│   └── performance.log                 # 性能日志
│
├── build/                              # 🏗️ 构建输出（.gitignore）
│   └── ...
│
├── dist/                               # 📦 发布包（.gitignore）
│   └── ...
│
├── .vscode/                            # IDE配置
│   ├── settings.json
│   └── launch.json
│
├── .gitignore                          # Git忽略文件
├── .gitattributes                      # Git属性配置
├── README.md                           # 项目说明
├── CLAUDE.md                           # Claude指导文档
├── requirements.txt                    # Python依赖（如使用Python）
├── setup.py                            # 安装脚本
└── LICENSE                             # 许可证

```

---

## 3. 目录详细说明

### 3.1 docs/ - 文档目录
**用途**: 存放所有项目文档

**组织规则**:
- 规范类文档使用数字前缀（00-09）
- 设计类文档使用数字前缀（10-19）
- 开发类文档使用数字前缀（20-29）
- 测试类文档使用数字前缀（30-39）
- 运维类文档使用数字前缀（40-49）
- 原始设计文档保持原名

**禁止事项**:
- ❌ 不要在此目录放置代码文件
- ❌ 不要放置临时文件或草稿

### 3.2 src/ - 源代码目录
**用途**: 存放所有源代码

**组织规则**:
- 按功能模块划分子目录
- 每个模块必须有 `__init__.py`
- 核心逻辑（core/）不依赖渲染层
- 渲染层（rendering/）可依赖核心逻辑

**模块依赖关系**:
```
integration/ ──→ rendering/ ──→ core/
                    ↓
                  audio/
                    ↓
                  input/
```

### 3.3 assets/ - 资源目录
**用途**: 存放所有游戏资源

**命名规范**:
- 图片: `描述_状态.扩展名`，如 `button_hover.png`
- 音频: `描述.扩展名`，如 `rotate.wav`
- 使用小写字母+下划线

**文件格式要求**:
- 图片: PNG（透明）或JPG（不透明）
- 音效: WAV（短音效）或OGG（长音效）
- 音乐: MP3 或 OGG
- 字体: TTF 或 OTF

### 3.4 data/ - 数据目录
**用途**: 存放配置和关卡数据

**格式要求**:
- 使用JSON格式（易读易解析）
- 必须包含版本号字段
- 必须包含注释说明（在文档中）

**关卡文件命名**:
- 格式: `level_XXX.json`（XXX为三位数字）
- 示例: `level_001.json`, `level_002.json`

### 3.5 tests/ - 测试目录
**用途**: 存放所有测试代码

**组织规则**:
- 测试文件以 `test_` 开头
- 测试类以 `Test` 开头
- 测试方法以 `test_` 开头
- 目录结构镜像 `src/` 目录

### 3.6 tools/ - 工具目录
**用途**: 存放开发辅助工具

**适用场景**:
- 关卡编辑器
- 资源转换工具
- 自动化脚本
- 代码生成器

### 3.7 logs/ - 日志目录
**用途**: 运行时日志存储

**注意事项**:
- 此目录由程序自动创建
- 应添加到 `.gitignore`
- 日志文件按日期轮转

---

## 4. 文件命名规范

### 4.1 Python文件命名
```python
# ✅ 正确示例
grid_manager.py          # 模块文件
connectivity_checker.py  # 功能描述清晰
__init__.py             # 包初始化文件

# ❌ 错误示例
GridManager.py          # 不要使用大驼峰
grid-manager.py         # 不要使用连字符
gm.py                   # 不要使用缩写
```

### 4.2 配置文件命名
```
# ✅ 正确示例
game_config.json
audio_config.json
level_001.json

# ❌ 错误示例
config.json             # 太泛化
GameConfig.json         # 不要使用大驼峰
level1.json             # 使用三位数字
```

### 4.3 资源文件命名
```
# ✅ 正确示例
power_source.png
button_hover.png
rotate_sound.wav

# ❌ 错误示例
PowerSource.png         # 不要使用大驼峰
btn-hover.png           # 不要使用连字符
rotate.wav              # 缺少类型描述
```

---

## 5. 特殊文件说明

### 5.1 必需文件
| 文件名 | 位置 | 用途 |
|--------|------|------|
| `README.md` | 根目录 | 项目说明 |
| `CLAUDE.md` | 根目录 | Claude指导文档 |
| `requirements.txt` | 根目录 | Python依赖 |
| `.gitignore` | 根目录 | Git忽略规则 |
| `LICENSE` | 根目录 | 开源许可证 |

### 5.2 .gitignore 配置
```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
*.egg-info/

# IDE
.vscode/
.idea/
*.swp
*.swo

# 构建输出
build/
dist/
*.egg

# 日志
logs/
*.log

# 临时文件
*.tmp
*.bak
.DS_Store
Thumbs.db

# 配置文件（如包含敏感信息）
config/local_*.json
```

---

## 6. 目录创建检查清单

在开始开发前，确保以下目录已创建：

- [ ] `docs/` - 文档目录
- [ ] `src/core/` - 核心逻辑
- [ ] `src/rendering/` - 渲染层
- [ ] `src/audio/` - 音频系统
- [ ] `src/integration/` - 集成接口
- [ ] `src/utils/` - 工具类
- [ ] `assets/sprites/` - 精灵图
- [ ] `assets/audio/` - 音频文件
- [ ] `data/levels/` - 关卡数据
- [ ] `data/config/` - 配置文件
- [ ] `tests/unit/` - 单元测试
- [ ] `tools/scripts/` - 辅助脚本

---

## 7. 常见问题

### Q1: 为什么按功能而非文件类型组织？
**A**: 按功能组织使相关代码聚集在一起，便于维护和理解。例如，网格系统的所有代码都在 `core/grid/` 下，而不是分散在 `models/`、`controllers/`、`views/` 中。

### Q2: 核心逻辑为什么不能依赖渲染层？
**A**: 这样可以：
1. 独立测试游戏逻辑
2. 更换渲染引擎而不影响逻辑
3. 在无图形环境下运行（如服务器端验证）

### Q3: 为什么关卡文件使用三位数字？
**A**: 便于排序和扩展。`level_001.json` 到 `level_999.json` 可支持999个关卡，且文件列表自然排序。

### Q4: 日志目录需要提交到Git吗？
**A**: 不需要。日志是运行时生成的，应添加到 `.gitignore`。

---

## 8. 文档变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0.0 | 2026-01-19 | Claude | 初始版本，定义标准目录结构 |

---

**重要提示**: 所有开发人员必须严格遵守本规范。如需调整目录结构，必须先更新本文档并获得批准。
