# 环境配置指南

## 文档版本
- **版本号**: v1.0.0
- **创建日期**: 2026-01-20
- **最后更新**: 2026-01-20
- **文档状态**: 正式版

---

## 1. 概述

本文档提供完整的开发环境配置步骤，确保所有开发人员使用统一的环境。

### 1.1 环境要求

| 项目 | 要求 | 说明 |
|------|------|------|
| **操作系统** | Windows 10/11 | 主要开发平台 |
| **Python版本** | 3.8+ | 推荐3.10或3.11 |
| **Conda** | Anaconda/Miniconda | 环境管理工具 |
| **内存** | ≥8GB | 推荐16GB |
| **磁盘空间** | ≥2GB | 用于环境和依赖 |

---

## 2. Conda环境配置

### 2.1 环境信息

```
环境名称: Game
环境路径: D:\anaconda3\envs\Game
Python版本: 3.8+
```

### 2.2 激活环境

**每次开发前必须执行**：

```bash
# Windows CMD
conda activate Game

# Windows PowerShell
conda activate Game

# Git Bash
source activate Game
```

**验证环境激活**：
```bash
# 检查Python路径
python --version
which python  # 或 where python (Windows)

# 应该显示类似：
# D:\anaconda3\envs\Game\python.exe
```

---

## 3. 依赖安装

### 3.1 方式一：使用requirements.txt（推荐）

```bash
# 1. 激活conda环境
conda activate Game

# 2. 进入项目根目录
cd E:\projects\my_app\game

# 3. 安装所有依赖
pip install -r requirements.txt

# 4. 验证安装
pip list
```

### 3.2 方式二：手动安装核心依赖

如果requirements.txt安装失败，可以手动安装核心依赖：

```bash
# 激活环境
conda activate Game

# 核心游戏依赖
pip install pygame==2.5.2
pip install numpy==1.24.3
pip install pillow==10.0.0

# 开发工具
pip install pytest==7.4.0
pip install pytest-cov==4.1.0
pip install black==23.7.0
pip install pylint==2.17.5
pip install mypy==1.4.1
pip install isort==5.12.0
```

### 3.3 验证安装

```bash
# 测试pygame
python -c "import pygame; print(pygame.version.ver)"
# 应输出: 2.5.2

# 测试numpy
python -c "import numpy; print(numpy.__version__)"
# 应输出: 1.24.3

# 测试pillow
python -c "from PIL import Image; print(Image.__version__)"
# 应输出: 10.0.0
```

---

## 4. 开发工具配置

### 4.1 VSCode配置

#### 4.1.1 安装推荐扩展

在VSCode中安装以下扩展：

```json
{
  "recommendations": [
    "ms-python.python",           // Python支持
    "ms-python.vscode-pylance",   // 智能提示
    "ms-python.black-formatter",  // 代码格式化
    "ms-python.isort",            // Import排序
    "ms-python.pylint",           // 代码检查
    "littlefoxteam.vscode-python-test-adapter",  // 测试支持
    "eamodio.gitlens",            // Git增强
    "donjayamanne.githistory"     // Git历史
  ]
}
```

#### 4.1.2 配置Python解释器

1. 按 `Ctrl+Shift+P`
2. 输入 `Python: Select Interpreter`
3. 选择 `D:\anaconda3\envs\Game\python.exe`

#### 4.1.3 工作区设置

创建 `.vscode/settings.json`：

```json
{
  "python.defaultInterpreterPath": "D:\\anaconda3\\envs\\Game\\python.exe",
  "python.formatting.provider": "black",
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": true,
  "python.testing.pytestEnabled": true,
  "python.testing.unittestEnabled": false,
  "editor.formatOnSave": true,
  "editor.rulers": [88],
  "files.exclude": {
    "**/__pycache__": true,
    "**/*.pyc": true
  }
}
```

### 4.2 PyCharm配置

#### 4.2.1 配置Python解释器

1. `File` → `Settings` → `Project` → `Python Interpreter`
2. 点击齿轮图标 → `Add`
3. 选择 `Conda Environment` → `Existing environment`
4. 选择 `D:\anaconda3\envs\Game\python.exe`

#### 4.2.2 配置代码风格

1. `File` → `Settings` → `Editor` → `Code Style` → `Python`
2. 设置 `Line length`: 88
3. 启用 `Use PEP 8 naming convention`

---

## 5. 环境验证

### 5.1 运行验证脚本

创建 `tools/scripts/verify_environment.py`：

```python
"""环境验证脚本"""
import sys
import importlib

def check_python_version():
    """检查Python版本"""
    version = sys.version_info
    print(f"✓ Python版本: {version.major}.{version.minor}.{version.micro}")
    if version.major < 3 or (version.major == 3 and version.minor < 8):
        print("✗ 警告: Python版本过低，需要3.8+")
        return False
    return True

def check_package(package_name, min_version=None):
    """检查包是否安装"""
    try:
        module = importlib.import_module(package_name)
        version = getattr(module, '__version__', 'unknown')
        print(f"✓ {package_name}: {version}")
        return True
    except ImportError:
        print(f"✗ {package_name}: 未安装")
        return False

def main():
    """主函数"""
    print("=" * 50)
    print("环境验证")
    print("=" * 50)

    # 检查Python版本
    check_python_version()

    # 检查核心依赖
    print("\n核心依赖:")
    check_package('pygame')
    check_package('numpy')
    check_package('PIL')  # Pillow

    # 检查开发工具
    print("\n开发工具:")
    check_package('pytest')
    check_package('black')
    check_package('pylint')
    check_package('mypy')

    print("\n" + "=" * 50)
    print("验证完成")
    print("=" * 50)

if __name__ == '__main__':
    main()
```

运行验证：

```bash
conda activate Game
python tools/scripts/verify_environment.py
```

### 5.2 预期输出

```
==================================================
环境验证
==================================================
✓ Python版本: 3.10.12

核心依赖:
✓ pygame: 2.5.2
✓ numpy: 1.24.3
✓ PIL: 10.0.0

开发工具:
✓ pytest: 7.4.0
✓ black: 23.7.0
✓ pylint: 2.17.5
✓ mypy: 1.4.1

==================================================
验证完成
==================================================
```

---

## 6. 常见问题

### 6.1 conda activate 命令不可用

**问题**: 提示 `conda: command not found`

**解决方案**:
```bash
# 初始化conda
conda init bash  # 或 conda init powershell

# 重启终端后再试
conda activate Game
```

### 6.2 pip安装速度慢

**问题**: pip下载依赖很慢

**解决方案**: 使用国内镜像源
```bash
# 临时使用
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 永久配置
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### 6.3 pygame安装失败

**问题**: `error: Microsoft Visual C++ 14.0 is required`

**解决方案**:
1. 下载安装 [Visual C++ Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)
2. 或使用预编译wheel：
   ```bash
   pip install pygame --only-binary :all:
   ```

### 6.4 权限错误

**问题**: `PermissionError: [WinError 5] Access is denied`

**解决方案**:
```bash
# 使用管理员权限运行终端
# 或添加 --user 参数
pip install -r requirements.txt --user
```

### 6.5 依赖冲突

**问题**: 包版本冲突

**解决方案**:
```bash
# 清理环境重���安装
pip uninstall -y -r requirements.txt
pip install -r requirements.txt
```

---

## 7. 环境维护

### 7.1 更新依赖

```bash
# 更新单个包
pip install --upgrade pygame

# 更新所有包
pip install --upgrade -r requirements.txt
```

### 7.2 导出当前环境

```bash
# 导出已安装的包
pip freeze > requirements_freeze.txt

# 导出conda环境
conda env export > environment.yml
```

### 7.3 清理环境

```bash
# 清理pip缓存
pip cache purge

# 清理conda缓存
conda clean --all
```

---

## 8. 环境隔离最佳实践

### 8.1 不要在base环境安装包

```bash
# ✗ 错误做法
conda activate base
pip install pygame

# ✓ 正确做法
conda activate Game
pip install pygame
```

### 8.2 使用虚拟环境

```bash
# 如果需要创建新环境
conda create -n Game python=3.10
conda activate Game
pip install -r requirements.txt
```

### 8.3 定期备份环境

```bash
# 导出环境配置
conda env export > environment_backup_$(date +%Y%m%d).yml
```

---

## 9. 快速启动脚本

### 9.1 Windows批处理脚本

创建 `start_dev.bat`：

```batch
@echo off
echo ========================================
echo 电路板修复游戏 - 开发环境启动
echo ========================================

REM 激活conda环境
call conda activate Game

REM 检查环境
python --version
echo.

REM 进入项目目录
cd /d E:\projects\my_app\game

echo 环境已激活，可以开始开发
echo 运行游戏: python main.py
echo 运行测试: pytest
echo ========================================

cmd /k
```

### 9.2 使用方法

双击 `start_dev.bat` 即可自动激活环境并进入项目目录。

---

## 10. 检查清单

### 10.1 环境配置完成检查

- [ ] Conda已安装
- [ ] Game环境已创建
- [ ] 可以成功激活Game环境
- [ ] requirements.txt中的依赖已安装
- [ ] pygame可以正常导入
- [ ] 验证脚本运行通过
- [ ] IDE已配置正确的Python解释器
- [ ] Git已配置用户信息

### 10.2 开发工具检查

- [ ] VSCode/PyCharm已安装
- [ ] Python扩展已安装
- [ ] 代码格式化工具可用（black）
- [ ] 代码检查工具可用（pylint）
- [ ] 测试框架可用（pytest）

---

## 11. 参考资料

- [Conda官方文档](https://docs.conda.io/)
- [Pygame官方文档](https://www.pygame.org/docs/)
- [Python虚拟环境指南](https://docs.python.org/3/tutorial/venv.html)
- [pip用户指南](https://pip.pypa.io/en/stable/user_guide/)

---

## 12. 文档变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0.0 | 2026-01-20 | Claude | 初始版本，创建完整的环境配置指南 |

---

**重要提示**:
1. 每次开发前必须激活Game环境
2. 不要在base环境安装项目依赖
3. 遇到问题先查看"常见问题"章节
4. 定期更新依赖包到最新稳定版本
